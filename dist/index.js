var __defProp=Object.defineProperty,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__publicField=(e,t,n)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),n);const tategaki=function(e){"use strict";var t,n;(n=t||(t={})).default="default",n.cjkPunc="cjk-punc",n.fullwidthAlphabet="fullwidth-alphabet",n.latin="latin",n.kana="kana",n.ambiguous="ambiguous",String.prototype.segmentise=function(e){let n,i=String(this),s=[],u=0;for(;n=e.exec(i);){let e;n.index>u&&s.push({content:i.substring(u,n.index),formatGuide:t.default}),n[1]?e=t.ambiguous:n[2]?e=t.cjkPunc:n[3]?e=t.fullwidthAlphabet:n[4]?e=t.latin:n[5]&&(e=t.kana),s.push({content:n[0],formatGuide:e}),u=n.index+n[0].length}return i.length>u&&s.push({content:i.substring(u),formatGuide:t.default}),s};return e.Tategaki=class{constructor(e,t){__publicField(this,"rootElement"),__publicField(this,"config"),this.rootElement=e;this.config=Object.assign({},{shouldPcS:!0,imitatePcS:!0,imitateTransfromToFullWidth:!0,shouldRemoveStyle:!1},t)}parse(){this.config.shouldRemoveStyle&&this.removeStyle(),this.rootElement.classList.add("tategaki"),this.rootElement.classList.add(this.config.imitatePcS?"imitate-pcs":"opentype-pcs"),this.format(this.rootElement),this.tcy(),this.correctAmbiguous()}setElementAttributes(e,n){switch(n.formatGuide){case t.default:return void(e.innerHTML=this.postProcess(n.content));case t.latin:e.setAttribute("lang","en");break;case t.cjkPunc:this.config.shouldPcS&&(e.innerHTML=this.squeeze(n.content))}e.classList.add(n.formatGuide)}postProcess(e){return e.replace(/\n[ \n]*/g,'<br /><span class="indent"></span>')}format(e,t=!0){if(e.nodeType===Node.TEXT_NODE){let t=e.nodeValue;if(!t.trim())return;t=this.correctPuncs(t);let n=/([\u002f\u2013]+|――)|([\u3001\u3002\u301d\u301f\uff01\uff0c\uff1a\uff1b\uff1f\u3008-\u3011\u3014-\u301B\uff08\uff09]+)|([\uff21-\uff3a\uff41-\uff5a]+)|([\p{Script=Latin}0-9\u0020-\u0023\u0025-\u002b\u002c-\u002e\u003a\u003b\u003f\u0040\u005b-\u005d\u005f\u007b\u007d\u00a1\u00a7\u00ab\u00b2\u00b3\u00b6\u00b7\u00b9\u00bb-\u00bf\u2010-\u2012\u2018\u2019\u201c\u201d\u2020\u2021\u2026\u2027\u2030\u2032-\u2037\u2039\u203a\u203c-\u203e\u2047-\u2049\u204e\u2057\u2070\u2074-\u2079\u2080-\u2089\u2150\u2153\u2154\u215b-\u215e\u2160-\u217f\u2474-\u249b\u2e18\u2e2e]+)|([\u3041-\u309f\u30a0-\u30fa\u30fc\u30ff]+)/gu,i=t.segmentise(n),s=e.parentElement;return void(s.childElementCount||1!==i.length?(i.forEach((t=>{let n=document.createElement("span");n.innerText=t.content,this.setElementAttributes(n,t),s.insertBefore(n,e)})),s.removeChild(e)):this.setElementAttributes(s,i[0]))}if("BR"===e.nodeName)return;const n="P"===e.nodeName||"BLOCKQUOTE"===e.nodeName;Array.from(e.childNodes).forEach((e=>{this.format(e,!n&&t)}))}removeStyle(e=this.rootElement){e.removeAttribute("style"),e.removeAttribute("width"),e.removeAttribute("height"),Array.from(e.children,(e=>{this.removeStyle(e)}))}correctPuncs(e){return e.replace(/——|──/g,"――").replace(/……/g,"⋯⋯")}squeeze(e){return e.split("").map((e=>{if(/[\u3001\u3002\uff0c\uff01\uff1a\uff1b\uff1f]/.test(e))return`<span class="squeeze-other-punc">${e}</span>`;const t="〝"===e||e.charCodeAt(0)%2==0;let n=`<span class="${t?"squeeze-in":"squeeze-out"}">${e}</span>`;return this.config.imitatePcS?t?'<span class="squeeze-in-space"></span>'+n:n+'<span class="squeeze-out-space"></span>':n})).join("")}transfromToFullWidth(e){const t="0".charCodeAt(0),n="０".charCodeAt(0),i=e.charCodeAt(0);return String.fromCharCode(i-t+n)}tcy(){let e=document.documentElement,n=window.getComputedStyle(e).fontSize.match(/(\d+)px/)[1],i=parseInt(n);Array.from(this.rootElement.getElementsByClassName(t.latin)).forEach((e=>{const n=e.innerHTML.trim();if(!(e.previousElementSibling&&e.previousElementSibling.classList.contains(t.ambiguous)||e.nextElementSibling&&e.nextElementSibling.classList.contains(t.ambiguous))&&/^[\w\p{Script=Latin}]/u.test(n)&&"I"!=e.nodeName&&"EM"!=e.nodeName&&"I"!=e.parentElement.nodeName&&"EM"!=e.parentElement.nodeName)if(1==n.length)this.config.imitateTransfromToFullWidth?e.innerHTML=this.transfromToFullWidth(n):(e.innerHTML=n,e.classList.add("to-fullwidth")),e.classList.remove("latin"),e.removeAttribute("lang");else if(/^([A-Z]{3,10}|\d{4,10})$/.test(n))this.config.imitateTransfromToFullWidth?e.innerHTML=Array.from(n,(e=>this.transfromToFullWidth(e))).join(""):(e.innerHTML=n,e.classList.add("to-fullwidth")),e.classList.remove("latin"),e.removeAttribute("lang");else if(/^[A-Z]{2}$|^\d{2,3}$/.test(n))e.innerHTML=n,e.classList.remove("latin"),e.removeAttribute("lang"),e.classList.add("tcy");else if(/^\d{1,3}%$/.test(n)){const t=/^(\d{1,3})%$/.exec(n);let i=document.createElement("span"),s=t[1];1===s.length&&(s=this.transfromToFullWidth(s)),i.innerHTML=`<span ${1==s.length?"":'class="tcy"'}>${s}</span>&#8288;％`,e.replaceWith(i)}else{let t=i;e.innerHTML!=n?t*=1.5:t*=1.333,e.getBoundingClientRect().height<=t&&(e.innerHTML=n,e.classList.add("tcy"))}}))}correctAmbiguous(){Array.from(document.getElementsByClassName(t.ambiguous),(e=>{if("――"!==e.innerHTML)if(e.previousElementSibling&&e.nextElementSibling)if(e.previousElementSibling.classList.contains(t.latin)&&e.nextElementSibling.classList.contains(t.latin))e.classList.add("latin");else switch(e.innerHTML){case"/":e.innerHTML="／";break;case"–":e.innerHTML="―"}else e.classList.add("latin");else e.classList.add("aalt-on")}))}},Object.defineProperty(e,"__esModule",{value:!0}),e[Symbol.toStringTag]="Module",e}({});
