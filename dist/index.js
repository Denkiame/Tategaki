"use strict";var e,t;Object.defineProperty(exports,"__esModule",{value:!0}),exports[Symbol.toStringTag]="Module",(t=e||(e={})).default="default",t.cjkPunc="cjk-punc",t.fullwidthAlphabet="fullwidth-alphabet",t.latin="latin",t.kana="kana",t.ambiguous="ambiguous",String.prototype.segmentise=function(t){let n,s=String(this),i=[],u=0;for(;n=t.exec(s);){let t;n.index>u&&i.push({content:s.substring(u,n.index),formatGuide:e.default}),t=n[1]?e.ambiguous:n[2]?e.cjkPunc:n[3]?e.fullwidthAlphabet:n[4]?e.latin:n[5]?e.kana:e.default,i.push({content:n[0],formatGuide:t}),u=n.index+n[0].length}return s.length>u&&i.push({content:s.substring(u),formatGuide:e.default}),i};exports.Tategaki=class{constructor(e,t){this.rootElement=e;this.config=Object.assign({},{shouldPcS:!0,imitatePcS:!0,imitateTransfromToFullWidth:!0,shouldRemoveStyle:!1},t)}parse(){this.config.shouldRemoveStyle&&this.removeStyle(),this.rootElement.classList.add("tategaki"),this.rootElement.classList.add(this.config.imitatePcS?"imitate-pcs":"opentype-pcs"),this.format(this.rootElement),this.tcy(),this.correctAmbiguous()}setElementAttributes(t,n){switch(n.formatGuide){case e.default:return void(t.innerHTML=this.postProcess(n.content));case e.latin:t.setAttribute("lang","en");break;case e.cjkPunc:this.config.shouldPcS&&(t.innerHTML=this.squeeze(n.content))}t.classList.add(n.formatGuide)}postProcess(e){return e.replace(/\n[ \n]*/g,'<br /><span class="indent"></span>')}format(e,t=!0){if(e.nodeType===Node.TEXT_NODE){let t=e.nodeValue;if(!t.trim())return;t=this.correctPuncs(t);let n=/([\u002f\u2013]+|――)|([\u3001\u3002\u301d\u301f\uff01\uff0c\uff1a\uff1b\uff1f\u3008-\u3011\u3014-\u301B\uff08\uff09]+)|([\uff21-\uff3a\uff41-\uff5a]+)|([\p{Script=Latin}0-9\u0020-\u0023\u0025-\u002b\u002c-\u002e\u003a\u003b\u003f\u0040\u005b-\u005d\u005f\u007b\u007d\u00a1\u00a7\u00ab\u00b2\u00b3\u00b6\u00b7\u00b9\u00bb-\u00bf\u2010-\u2012\u2018\u2019\u201c\u201d\u2020\u2021\u2026\u2027\u2030\u2032-\u2037\u2039\u203a\u203c-\u203e\u2047-\u2049\u204e\u2057\u2070\u2074-\u2079\u2080-\u2089\u2150\u2153\u2154\u215b-\u215e\u2160-\u217f\u2474-\u249b\u2e18\u2e2e]+)|([\u3041-\u309f\u30a0-\u30fa\u30fc\u30ff]+)/gu,s=t.segmentise(n),i=e.parentElement;return void(i.childElementCount||1!==s.length?(s.forEach((t=>{let n=document.createElement("span");n.innerText=t.content,this.setElementAttributes(n,t),i.insertBefore(n,e)})),i.removeChild(e)):this.setElementAttributes(i,s[0]))}if("BR"===e.nodeName)return;const n="P"===e.nodeName||"BLOCKQUOTE"===e.nodeName;Array.from(e.childNodes).forEach((e=>{this.format(e,!n&&t)}))}removeStyle(e=this.rootElement){e.removeAttribute("style"),e.removeAttribute("width"),e.removeAttribute("height"),Array.from(e.children,(e=>{this.removeStyle(e)}))}correctPuncs(e){return e.replace(/——|──/g,"――").replace(/……/g,"⋯⋯")}squeeze(e){return e.split("").map((e=>{if(/[\u3001\u3002\uff0c\uff01\uff1a\uff1b\uff1f]/.test(e))return`<span class="squeeze-other-punc">${e}</span>`;const t="〝"===e||e.charCodeAt(0)%2==0;let n=`<span class="${t?"squeeze-in":"squeeze-out"}">${e}</span>`;return this.config.imitatePcS?t?'<span class="squeeze-in-space"></span>'+n:n+'<span class="squeeze-out-space"></span>':n})).join("")}transfromToFullWidth(e){const t="0".charCodeAt(0),n="０".charCodeAt(0),s=e.charCodeAt(0);return String.fromCharCode(s-t+n)}tcy(){let t=document.documentElement,n=window.getComputedStyle(t).fontSize.match(/(\d+)px/),s=n?parseInt(n[1]):0;Array.from(this.rootElement.getElementsByClassName(e.latin)).forEach((t=>{const n=t.innerHTML.trim();if(!(t.previousElementSibling&&t.previousElementSibling.classList.contains(e.ambiguous)||t.nextElementSibling&&t.nextElementSibling.classList.contains(e.ambiguous))&&/^[\w\p{Script=Latin}]/u.test(n)&&"I"!=t.nodeName&&"EM"!=t.nodeName&&(!t.parentElement||t.parentElement&&"I"!=t.parentElement.nodeName&&"EM"!=t.parentElement.nodeName))if(1==n.length)this.config.imitateTransfromToFullWidth?t.innerHTML=this.transfromToFullWidth(n):(t.innerHTML=n,t.classList.add("to-fullwidth")),t.classList.remove("latin"),t.removeAttribute("lang");else if(/^([A-Z]{3,10}|\d{4,10})$/.test(n))this.config.imitateTransfromToFullWidth?t.innerHTML=Array.from(n,(e=>this.transfromToFullWidth(e))).join(""):(t.innerHTML=n,t.classList.add("to-fullwidth")),t.classList.remove("latin"),t.removeAttribute("lang");else if(/^[A-Z]{2}$|^\d{2,3}$/.test(n))t.innerHTML=n,t.classList.remove("latin"),t.removeAttribute("lang"),t.classList.add("tcy");else if(/^\d{1,3}%$/.test(n)){const e=/^(\d{1,3})%$/.exec(n);let s=document.createElement("span"),i=e[1];1===i.length&&(i=this.transfromToFullWidth(i)),s.innerHTML=`<span ${1==i.length?"":'class="tcy"'}>${i}</span>&#8288;％`,t.replaceWith(s)}else{let e=s;t.innerHTML!=n?e*=1.5:e*=1.333,t.getBoundingClientRect().height<=e&&(t.innerHTML=n,t.classList.add("tcy"))}}))}correctAmbiguous(){Array.from(document.getElementsByClassName(e.ambiguous),(t=>{if("――"!==t.innerHTML)if(t.previousElementSibling&&t.nextElementSibling)if(t.previousElementSibling.classList.contains(e.latin)&&t.nextElementSibling.classList.contains(e.latin))t.classList.add("latin");else switch(t.innerHTML){case"/":t.innerHTML="／";break;case"–":t.innerHTML="―"}else t.classList.add("latin");else t.classList.add("aalt-on")}))}};
